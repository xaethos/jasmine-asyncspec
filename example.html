<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../build/build.css"></link>
    <script src="../build/build.js"></script>
  </head>
  <body>

    <script type="text/javascript">
      var jroot = require('bestander-jasmine');
      var jasmine = jroot.jasmine
      var describe = jroot.describe
      var beforeEach = jroot.beforeEach
      var it = jroot.it
      var xit = jroot.xit
      var expect = jroot.expect
      var runs = jroot.runs

      var asyncBlock = require('jasmine-asyncblock')(jasmine);
      var asyncSpec = function(spec) {
        return function() {
          asyncBlock(spec, {
            waitsFor: "test to finish running",
            timeout: 500
          });
        }
      };

      describe ("asyncBlock", function() {
        var spec = null

        beforeEach(function() {
          spec = jasmine.getEnv().currentSpec;
        });

        it ("runs the given block", function() {
          var blockRun = false;
          asyncBlock(function(done) {
            blockRun = true;
            done();
          });
          expect(blockRun).toBeFalsy();
          runs(function() {
            expect(blockRun).toBeTruthy();
          });
        });

        it ("fails the spec when the callback is given an argument", function() {
          asyncBlock(function(done) {
            done("PASS: this is an expected failure message");
          });
          runs(function() {
            expect(spec.results().failedCount).toEqual(1);
          });
        });

        it ("waits for done to be called", function() {
          var blockRun = false;
          asyncBlock(function(done) {
            setTimeout(function() {
              blockRun = true;
              done();
            }, 50);
          });
          runs(function() {
            expect(blockRun).toBeTruthy();
          });
        });

        it ("times out", function() {
          asyncBlock(function(done) {
            setTimeout(function() {
              done("block didn't timeout as expected");
            }, 1000);
          }, {
            timeout: 500,
            message: "PASS: this is an expected failure message"
          });
        });

      });
    </script>

    <script type="text/javascript">
      (function () {
       var currentWindowOnload;
       var reporter;
       var jasmine = require('bestander-jasmine').jasmine;
       var jasmineEnv = jasmine.getEnv();
       jasmineEnv.updateInterval = 1000;

       reporter = new jasmine.TrivialReporter();

       jasmineEnv.addReporter(reporter);

       jasmineEnv.specFilter = function (spec) {
         return reporter.specFilter(spec);
       };

       currentWindowOnload = window.onload;

       window.onload = function () {
         if (currentWindowOnload) {
           currentWindowOnload();
         }
         jasmineEnv.execute();
       };

      })();
    </script>

  </body>
</html>
